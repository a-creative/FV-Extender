<!DOCTYPE html>
<html>
	<head>
		<title>FV Extender - Settings</title>
		<link rel="stylesheet" href="../css/settings.css">
		<script type="application/x-javascript" src="../js/jquery-1.7.min.js"></script>	
		<script type="application/x-javascript">
			var bgp = chrome.extension.getBackgroundPage();
		
			$(document).ready( function() {
				
				loadSettings( false )
			
				$("#defaults-btn").click( function( evt ) {
					loadSettings( true );
					evt.preventDefault();
				});
				
				
				$("#save-btn").click( function( evt ) {
					
					var valid = true;
					
					if ( valid ) {
						saveSettings();
						window.close();
					}
					evt.preventDefault();
				});
				
				$("#cancel-btn").click( function( evt ) {
					window.close();
					evt.preventDefault();
				});
				
				
				$('.default-value')
					.each( function() {
						$(this).attr('default-value', $(this).val() );
					})
					.focus( function(){
						if ( $(this).val() == $(this).attr( 'default-value') ) {
							$(this).val('');
						}	
					} )
					.blur( function() {
						if ( $(this).val() == '' ) {
							$(this).val( $(this).attr('default-value') );
						}
					} )
				
				
			
			} );
			
			function loadSettings( loadDefaults ) {
				
				if ( loadDefaults ) {
					
					$("#user-settings .return-gift-text textarea").val(
						'This gift was returned by FV Extender for Google Chrome.'
					);
					
					$('#user-settings input:radio[name="sound"]').filter('[value="' + bgp.Settings.core_setting_defaults.audio_enabled + '"]').attr('checked', true);
					$('#user-settings input:radio[name="speed"]').filter('[value="' + bgp.Settings.core_setting_defaults.speed + '"]').attr('checked', true);
										
					
					if ( bgp.Settings.core_setting_defaults.rejectGifts === true || bgp.Settings.core_setting_defaults.rejectGifts === 'true') {
						$('#user-settings input:checkbox[name="reject_gifts"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_gifts"]').removeAttr('checked');
					}
					
					if ( bgp.Settings.core_setting_defaults.rejectNeighbors === true || bgp.Settings.core_setting_defaults.rejectNeighbors === 'true' ) {
						$('#user-settings input:checkbox[name="reject_neighbors"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_neighbors"]').removeAttr('checked');
					}
					
				} else {
					
					$('#user-settings input:radio[name="sound"]').filter('[value="' + bgp.Settings.core_settings.audio_enabled + '"]').attr('checked', true);
					$('#user-settings input:radio[name="speed"]').filter('[value="' + bgp.Settings.core_settings.speed + '"]').attr('checked', true);
										
					
					if ( bgp.Settings.core_settings.rejectGifts === true || bgp.Settings.core_settings.rejectGifts === 'true' ) {
						
						$('#user-settings input:checkbox[name="reject_gifts"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_gifts"]').removeAttr('checked');
					}
					
					if ( bgp.Settings.core_settings.rejectNeighbors === true || bgp.Settings.core_settings.rejectNeighbors === 'true' ) {
						$('#user-settings input:checkbox[name="reject_neighbors"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_neighbors"]').removeAttr('checked');
					}
					
					
					$("#user-settings .return-gift-text textarea").val( bgp.Settings.core_settings.returnGiftMessage );
				}
			}
			
			function saveSettings() {
				
				bgp.Settings.core_settings.returnGiftMessage = $("#user-settings .return-gift-text textarea").val();
				bgp.Settings.core_settings.audio_enabled = $('input:radio[name="sound"]:checked').val();
				bgp.Settings.core_settings.speed = $('input:radio[name="speed"]:checked').val();
				
				bgp.Settings.core_settings.rejectGifts = $('input:checkbox[name="reject_gifts"]').is(':checked') + "";
				bgp.Settings.core_settings.rejectNeighbors = $('input:checkbox[name="reject_neighbors"]').is(':checked') + "";
				
				bgp.Settings.saveSettings();
				
				window.close();
			}
			
			
		</script>		
	</head>
	<body>
		<div id="user-settings" class="user-settings"><div class="position"><div class="layers">
			<div class="border"></div>
			<div class="content">
				<div class="header default"><h1>FV Extender - Settings</h1></div>
				<div class="form">
					<div class="field return-gift-text">
						<div class="label">Text for "Thank you" gift:</div>
						<div class="input"><textarea></textarea></div>
						<br clear="all" />
					</div>
					<div class="field sound">
						<div class="label">Sound:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="radio" name="sound" value="1" /></div>
								<div class="text"><b>Enabled</b></div>
								<br clear="all" />
							</div>
							<div class="option">
								<div class="mark"><input type="radio" name="sound" value="0" /></div>
								<div class="text"><b>Disabled</b></div>
								<br clear="all" />
							</div>						
						</div>
						<br clear="all" />
					</div>
					<div class="field speed">
						<div class="label">Processing speed:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="radio" name="speed" value="1" /></div>
								<div class="text"><b>Default(No concurrent processes)</b></div>
								<br clear="all" />
							</div>
							<div class="option">
								<div class="mark"><input type="radio" name="speed" value="2" /></div>
								<div class="text"><b>Faster(2 simultaneous processes)</b></div>
								<br clear="all" />
							</div>
							<div class="option">
								<div class="mark"><input type="radio" name="speed" value="4" /></div>
								<div class="text"><b>Fastest(4 simultaneous processes)</b></div>
								<br clear="all" />
							</div>
						</div>
						<br clear="all" />
					</div>
					<div class="field reject-neighbors">
						<div class="label">Reject neighbor requests:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="checkbox" name="reject_neighbors" /></div>
								<div class="text"></div>
								<br clear="all" />
							</div>					
						</div>
						<br clear="all" />
					</div>
					<div class="field reject-gifts">
						<div class="label">Only accept non-gifts:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="checkbox" name="reject_gifts" /></div>
								<div class="text">(and reject the rest)</div>
								<br clear="all" />
							</div>					
						</div>
						<br clear="all" />
					</div>
					<div class="buttons">
						<a href="#" class="item button save" id="save-btn">Save</a>
						<a href="#" class="item button cancel" id="cancel-btn">Cancel</a>
						<a href="#" class="item button defaults" id="defaults-btn">Load defaults</a>
						<br clear="all" />
					</div>
				</div>				
			</div>			
		</div></div></div>		
	</body>
</html>