<!DOCTYPE html>
<html>
	<head>
		<title>FV Extender - Settings</title>
		<link rel="stylesheet" href="../css/settings.css">
		<script type="application/x-javascript" src="../js/jquery-1.7.min.js"></script>	
		<script type="application/x-javascript">
			var bgp = chrome.extension.getBackgroundPage();
		
			$(document).ready( function() {
				
				loadSettings( false )
			
				$("#defaults-btn").click( function( evt ) {
					loadSettings( true );
					evt.preventDefault();
				});
				
				
				$("#save-btn").click( function( evt ) {
					
					var valid = true;
					var activation_code_el = $( '.auto-process textarea:visible' )
					if ( activation_code_el && activation_code_el.length && activation_code_el.val() != activation_code_el.attr('default-value' ) ) {
						if (
								(	activation_code_el.val() === 'The value of a man resides in what he gives and not in what he is capable of receiving.' )
							||	(	activation_code_el.val() === 'We make a living by what we get, but we make a life by what we give.' )
							||	(	activation_code_el.val() === 'You cannot do a kindness too soon because you never know how soon it will be too late.' )
							||	(	activation_code_el.val() === 'Love grows by giving. The love we give away is the only love we keep. The only way to retain love is to give it away.' )
							||	(	activation_code_el.val() === 'Many people despise wealth, but few know how to give it away.' )
						) {
							bgp.settings.feature_activate_auto_process = '1';
							alert( 'The feature "Auto process" was activated successfully. Now click "Auto process" in the FVE menu to start using the feature for the first time.')
						} else {
							alert( 'The feature "Auto process" failed to activate. Please re-type the received activation code and click "Save" again.')
							valid = false;
						}
					}
					
					if ( valid ) {
						saveSettings();
						window.close();
					}
					evt.preventDefault();
				});
				
				$("#cancel-btn").click( function( evt ) {
					window.close();
					evt.preventDefault();
				});
				
				
				$('.default-value')
					.each( function() {
						$(this).attr('default-value', $(this).val() );
					})
					.focus( function(){
						if ( $(this).val() == $(this).attr( 'default-value') ) {
							$(this).val('');
						}	
					} )
					.blur( function() {
						if ( $(this).val() == '' ) {
							$(this).val( $(this).attr('default-value') );
						}
					} )
				
				
			
			} );
			
			function loadSettings( loadDefaults ) {
				
				if ( loadDefaults ) {
					
					$("#user-settings .return-gift-text textarea").val(
						'This gift was returned by FV Extender for Google Chrome.'
					);
					
					$('#user-settings input:radio[name="sound"]').filter('[value="' + bgp.setting_defaults.audio_enabled + '"]').attr('checked', true);
					
					if ( bgp.setting_defaults.rejectGifts == 'true') {
						$('#user-settings input:checkbox[name="reject_gifts"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_gifts"]').removeAttr('checked');
					}
					
					if ( bgp.setting_defaults.rejectNeighbors == 'true' ) {
						$('#user-settings input:checkbox[name="reject_neighbors"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_neighbors"]').removeAttr('checked');
					}
					
				} else {
					
					$('#user-settings input:radio[name="sound"]').filter('[value="' + bgp.settings.audio_enabled + '"]').attr('checked', true);
					
					if ( bgp.settings.rejectGifts == 'true' ) {
						
						$('#user-settings input:checkbox[name="reject_gifts"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_gifts"]').removeAttr('checked');
					}
					
					if ( bgp.settings.rejectNeighbors == 'true' ) {
						$('#user-settings input:checkbox[name="reject_neighbors"]').attr('checked', 'checked' );
					} else {
						$('#user-settings input:checkbox[name="reject_neighbors"]').removeAttr('checked');
					}
					
					
					$("#user-settings .return-gift-text textarea").val( bgp.settings.returnGiftMessage );
				}
				
				
				if ( bgp.settings.feature_activate_auto_process === '1' ) {
					$('.auto-process .activated').css('display', 'block' );
					$('.auto-process .deactivated').css('display', 'none' );
				} else {
					$('.auto-process .activated').css('display', 'none' );
					$('.auto-process .deactivated').css('display', 'block' );
				}
			}
			
			function saveSettings() {
				
				bgp.settings.returnGiftMessage = $("#user-settings .return-gift-text textarea").val();
				bgp.settings.audio_enabled = $('input:radio[name="sound"]:checked').val();
				
				bgp.settings.rejectGifts = $('input:checkbox[name="reject_gifts"]').is(':checked')
				bgp.settings.rejectNeighbors = $('input:checkbox[name="reject_neighbors"]').is(':checked')
				
				bgp.saveSettings();
				
				window.close();
			}
			
			
		</script>		
	</head>
	<body>
		<div id="user-settings" class="user-settings"><div class="position"><div class="layers">
			<div class="border"></div>
			<div class="content">
				<div class="header default"><h1>FV Extender - Settings</h1></div>
				<div class="form">
					<div class="field return-gift-text">
						<div class="label">Text for "Thank you" gift:</div>
						<div class="input"><textarea></textarea></div>
						<br clear="all" />
					</div>
					<div class="field sound">
						<div class="label">Sound:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="radio" name="sound" value="1" /></div>
								<div class="text"><b>Enabled</b></div>
								<br clear="all" />
							</div>
							<div class="option">
								<div class="mark"><input type="radio" name="sound" value="0" /></div>
								<div class="text"><b>Disabled</b>.</div>
								<br clear="all" />
							</div>						
						</div>
						<br clear="all" />
					</div>
					<div class="field reject-neighbors">
						<div class="label">Reject neighbor requests:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="checkbox" name="reject_neighbors" /></div>
								<div class="text"></div>
								<br clear="all" />
							</div>					
						</div>
						<br clear="all" />
					</div>
					<div class="field reject-gifts">
						<div class="label">Only accept non-gifts:</div>
						<div class="input">
							<div class="option">
								<div class="mark"><input type="checkbox" name="reject_gifts" /></div>
								<div class="text">(and reject the rest)</div>
								<br clear="all" />
							</div>					
						</div>
						<br clear="all" />
					</div>
					<div class="field auto-process">
						<div class="label">Activate feature<br /> "Auto process" (<a href="http://a-creative.dk/donate/auto-process-feature-activation/" title="Click '?' to read more about this feature and how to get an activation code">?</a>):</div>
						<div class="input">
							<textarea type="text" class="default-value deactivated">Type received activation code here...</textarea></textarea>
							<div class="activated">(the "Auto process" feature is active)</div>
						</div>
						<br clear="all" />
					</div>
					<div class="buttons">
						<a href="#" class="item button save" id="save-btn">Save</a>
						<a href="#" class="item button cancel" id="cancel-btn">Cancel</a>
						<a href="#" class="item button defaults" id="defaults-btn">Load defaults</a>
						<br clear="all" />
					</div>
				</div>				
			</div>			
		</div></div></div>		
	</body>
</html>